# 舍不得花27980买马士兵教育的MCA架构师课程？免费开源马士兵教育VIP课程 - P5：【JVM调优实战】什么是垃圾？如何定位垃圾？ - 马士兵北京中心 - BV1VP411i7E4

佢这里。来聊聊JVM的DC的历史啊，就这块的内容呢，我稍微补一点最基本的这种技术上的概念。我们先来说呢，到底什么是一个垃圾。就是我们刚才说嘛，如果是你呃采用这种引进垃圾回收器的这样的一些个语言的话。

那你你总得找出来，就是业务线程在这里不停的扔线头，扔线头，扔线头，线头和线团之间呢，有各种各样的线来进行关联。好，作为垃圾回收线程的角度来说，我得去定位啊，这这这到这到底哪个是垃圾，哪个线头是垃圾啊。

怎么找啊，这里面的找法呢，一共有两种。这什么是垃圾？我们先定义什么是垃圾？这垃圾呢其实很简单，就是你看这你看下面这个对象，这个对象呢在运行的过程之中没有任何引用指向它了。

原来呢有一个成员边论的引用指向它。有现在没有了。好，这哥们就是垃圾，这肯定的。😊，没有人没有引用指向他了。好，他就是垃圾。但是我们怎么定位这个垃圾呢？定位这个垃圾的话有两种方式。

第一种呢叫reference count图。你看一下看一下动画就理解。就是这个对象呢，我给他做一个计数，引用计数法，这叫。有3个目前有三个引用指向，我我脑袋脑门上写了一3啊。接下来如果有一个引用消失了。

变成二，有一些用消失变成一，有一个引用消失变成0。当它变成零的时候，这哥们儿成为垃圾。python就是使用这样的方式。这个叫引用基数法，引用基数法有毛病，毛病在于哪儿呢？我们假如说有一堆垃圾。

有三个垃圾。A对向BB对向C。C又指向A。好，所有的对象都有引用指向，但是没有任何其他的引用指向。这三个对象中的任何一个啊，这叫做三个垃圾，一堆垃圾，一坨垃圾。那么像这样的话。

如果你用reference count的方式就找不出来。因此，java里面采用的并不是这种方式，怎么定位一个垃圾。java里面采用的是这种方式叫做。根可达算法叫reearing。这算法一说，你就明白。

根可达算法的意思是我们从根上开始，什么叫根？媚函数里面，你简单理解媚函数里面的一个一个变量，这就是根，就魅函数。通过这根线来跟着捋捋到谁，谁就不是垃圾，它的成员变量又指向了它，它的成员变量又指向它。

又指向它又指向它。好，这几个全部是垃圾。顺着这根线找找不到谁的时候，竖的搜索算法，找不到的这些全是垃圾。这个大家能听明白吗？有没有同学有疑问的？嗯，循环引用不能把引用断开吗？人家业务逻辑就要循环引用。

你为什么要给人断开？你断开，人家业务逻辑不变了吗？大哥。当然大厂面试的时候呢，有一个问题叫做什么是根儿啊。如果要讲这些细节的话，我我倾向于讲东西呢，是先从很高的层面来讲。呃。

我建议大家学东学学课程也是一定是要什么呢？先建立知识体系，这件事情超级重要。有很多人呢连最基本的学习方法都不会可以说啊，从小学到大学学了这么多年，最基本的学习方法没学会。一定要先建立知识体系。

然后再去查漏补缺。我讲的再形象一点，你掌握一棵知识树的时候，先把树干给我掌握了。然后再去两个树枝。然后再去。掌握树叶。你的树干跟树枝子你啊你的树干只要是特别稳固的话，你树叶想刮多少刮多少。

现在很多的碎片化的学习都是让你掌握树叶的知识。你掌握了多少树叶都没有用，因为你没有建立整个树干的体系。了解一个庐山，你得坐着飞机从上空飞过看庐山的整个面貌。

而不是说你到庐山脚下某一棵树底下去研究庐山的蚂蚁窝。这种纯属扯淡。听我说。我上这么多年学，我记得我上大学的时候有一个学期把。清华图书馆所有的物理书。那藏书很多的啊，大概得有。

几万本1一个学期我全把它全部它看完了。当然没记得多少，但是整个物理的体系慢慢就建立起来了。😊，呃，小伙伴们，你们呢如果不同意这个说法的话，我不管你同意不同意，你采用一下，你试试看就知道。

要先要先建立知识体系。听懂了吗？嗯，建立知识体系之后再去研究那些细节。好吧，知识体系的建立呢就是囫囵吞枣四个字叫囫囵吞枣。有好多人学东西啊特别好玩。呃，他在学习的过程中，假如说这是一棵知识树。嗯。

他在学习的过程中，他学到某一个节点的时候，他会顺着啊就每一个细节。比如说别人给他讲dos窗口，你怎么设置环境变量啊，咱们学只要的人一般都会遇上是吧？

怎么设置环境变量怎么设置passclass pass他就开始研究哇这dos挺好玩的啊，这dos还能写BAT这这个这个这个点这这呃脚本语言呢啊，我研究研究这个脚本语言怎么玩吧。

然后啊这dos窗口怎么产生的呢？研究研显卡嗯。😊，杨岩先生，哎呦，哎，玩玩PS哈哈我跟你说，完蛋，你要这么学，你的时间就是全部浪费，没有用。😊，而是你应该怎么学呢？先二话不说，把整个这些关键的点全拿下。

拿下之后呢，再去发散，再去纠细节。我大概就是这意思，好吧。嗯，那就是先先看完本书呗。行行行，你这个理解能力我也是醉了，看来我还是我表达的不够啊，sorry。好，我讲到这儿呢。

我是希望大家呢先把这个什么是根儿这件事呢先略过，不要着急。因为如果作为。呃，官方的非常规范的定义来说，你得去看哪本书呢？叫JVMS。

The Java virtual machine specification。呃，这本书呢是在orac克网站上可以下载，它的全称叫做JVM的虚拟机规范规范大哥。他很枯燥的。

也只有像老师这样特别无聊的人才会去读他。其他人你不用读。作为哥来说。这本书上给你说的非常明确，它包括这么几部分内容，GYM stack的内容，tack站native method stack又是站。

runtime constant pool运行时常量常量迟。steady reference method area方法区里面的静态引用，以及我们的class类的对象。这里面的任何一个拿出来。

你不了解JVM底层，直接就把你给看晕了。所以你不用管根儿嘛，我给你举个最简单例子就行了嘛。ma方法里面呢有一句话叫object小O，等于new objectject。好，这哥们就是根儿，听懂了吗？

很简单，就是方法整个程序开始执行的地方，最先建立起来那些对象，这些哥们们叫根儿叫root。呃，专业说它就是这Mmt里面内容。Stack吗？站里面的我们的方法里面不是位于我们线程站吗？主线程站对不对？

站里面对象。get了吗？好，我们可以继续吗？先把它略过好不好嗯。😊，所以从根儿上开始找，本意就是从根上开始找，反正是顺着根儿捋捋捋嗯。就是我我还是喜欢讲的稍微形象一点啊，形象一点就是你比方说你。😊，嗯。

你女朋友你男朋友啊，你你你们哥仨，你们姐仨啊，甭管是哥仨姐仨。在一个空间里面，内存里面扔小线团儿。谁是根啊，你们仨就是根儿，你们的手捋着这个小线头，捋到的全都不是垃圾，凡是捋不到的。

中间那个线给断了的全都是垃圾。就这意思。这样的话呢，你就不会给产，就是那种原来像这种互相引用的。但是哎你顺着歌，只要找不着，他这哥俩就是垃圾。够啦。好。这是第二种算法，叫根可达。非常简单啊。

