# 系列 6：P3：GC - 马士兵学堂 - BV1RY4y1Q7DL

ok我们继续在这里面呢，我给交代给大家澄清几个，你们在文章里头经常可能会读到啊，但是特别容易混淆的概念，就是minor gc y d c这个指的是啥，指的是年轻代的回收，如果你在文章上读到的话。

mandc y dc指的都是年轻代回收，什么时候年轻再回收啊，分配不下了吗，分配不下了，你是不是得回收一点，取满了你不就得回收吗，所以这个东西年轻的空间耗尽是被触发嘛，很正常，老年代的回收指的是什么呢。

一般的称之为major dc major，当然另外一个更加广泛的称呼叫做f g c，f的意思是full fdc，全回收，全回收其实指的是年轻代也回收，老年代也回收。

但有的时候在特定语境里指的是老年代回收，无所谓，能理解就行，概念这东西是人类发明出来用来沟通用的，原来的人类在这个在远古的人类，在广阔的无垠的大草原上，看到这么一个东西的时候，他不知道是个啥。

热烘烘冒着热气，后来他们肯定是互相打招呼啊，你过来看看这个模样的这个东西，后来终于有人类发明了一个概念，这个概念叫，说这个东西是个，它是不能吃的，ok互相之间发明出来沟通用的，你理解的东西是什么就行了。

说你非得叫它叫或者叫boopop，或者叫叫叫叫叫粑粑是吧，都都都可以，千万不要在这里咬文嚼字，凡是在这咬文嚼字的，你这个学学学习的方法，都是属于那种孔乙己式的学习，没意思啊，会把你学的特别累。

而且呢还没啥用好了，灵活一点啊，灵活一点，就跟刚才那p 10似的是吧，你承认你就承认他牛不就完了吗，你每年四五百万的年薪拿到了它不香吗，看这里啊，老年代无法继续分配空间。

是触发了新新生代老年代同时进行回收，就老年代满了就触发f g c了，这不很正常吗，刚才不是有同学问吗，你像这样的问题，为什么还要问老师，那我搞不懂什么时候我要清理啊，哎当然就是空间占满了，我要清理。

当然这是一个形象的概念，其实呢它有一些特定的垃圾回收器，每种是不一样的，有的垃圾回收器是占到一定比例的时候，就开始回收了，有的垃圾回收器呢，是需要确实要占满的时候才来才进行回收，而总而言之。

空间不够使了，我预测到空间不够用了，我马上要开始清理了，这个时候开始触发，所以下次你们再聊，这种概念的时候一定给我记着，你们第一次聊的时候，一定得跟面试官聊，我用的是哪种垃圾回收器，各种垃圾回收器。

他用的东西，用的算法以及各种触发的时机都是不一样的，你要这么问的话，就显得你特别业余，o我们再稍微回顾一下哈，我把一些细节先忽略掉，做一个小小的动画总结嗯，这个小动画呢大家看完脑子里存印象，一般来说。

动画的对你脑子里的刺激会要比图片要好，图片对你脑子刺激要比文字要好啊，所以我尽量的选择刺激你更加强烈的地方，ok，当然做动画其实挺难的，我这动画做了俩小时啊，基本上三分钟就给你演示完了，好好听。

当我们new出一个对象来的时候，首先他会在站上进行分配，你记着就行了，有这么一回事，如果你要非要细究这个概念的话，你学过c语言里面有一个struct结构体，你又能理解。

为什么java里面还可以在站上进行分配，在站上进行分配有什么好处啊，如果没学过，你就单独扔一边，不管它，总而言之，java某些特定的小的对象是可以分配在栈上的，在站上有一个什么好处，大家还记得吗。

这站是个什么东西啊，站里面装的战争，每个方法对应一个战争，对不对，哎这个方法里面用到的这些个对象，如果方法结束了，整个战争，背往下一盘，就是就是暂停指针往下一挪啊，这意思，里边这个内存就回收了。

就这么简单，所以如果你要是把对象，把这个对象分配在栈上的话，分配在这里的话，什么时候对象不用了，分弹出去了，给它效率非常高，它不需要什么呀，只需要g，不需要gc的介入，不需要清洁工的介入。

不需要你爸爸妈妈来帮你清理这些小线段，这是在栈上分配，如果能在栈上分配下，分配在栈上站，只要往外一弹，整个程序就结束，这个对象也就结束了，当然如果站上分配不下怎么办，分配不下，看这个对象够不够大。

多大是大，可以自己设置好，如果对象个儿特别大，这个时候直接扔到老年代，而不会扔到年轻代，ok老年代什么时候他才会被回收啊，只有经过fdc之后，那不大不小，也不能在站上进行分配，那这时候分配在哪呢。

这时候分配的一个空间叫t r a b，叫three local cation buffer，全称是这样的，thread，这不写了啊，这很简单，线程吗，local线程本地allocation。

lover好，allocation的意思就是分配的意思啊，allocation我就给你写错了，叫县城本地缓冲区，有同学说这是个什么东东，别着急，你听我解释，如果你在这里能分配一下，或者在这里分配不下。

其实最终都会分配到一边去，所以这个东西呢，呃你知道有这么一个东西存在就可以了，除非你调音调的特别精细的时候才需要调，这个一般用不着啊，一般用不着，t r a b是个什么东西呢，叫做县城本地缓冲区。

什么叫县城本地缓冲区，是这么一回事，当我们往依恋区里头分配对象的时候，我们有好多好多线程，每一个县城都要往里头分配，那就会有县城竞争，我们都要抢抢这个空间，第五个小格，我的我的我的我的。

那么到底是谁的呢，所以我的jvm要管理这些线程的竞争，因此我要浪费好多资源，管理这些线程到底竞争所同步吗，那那好，所以在gbm里面做了这样一个优化，就是每一个线程启动的时候，给每一个线程。

在伊甸区里面分配一个小小的空间，是这个线程专属的，我觉得这个是这个写成专属的，这是线程一专属，这写成二专属，当分配对象的时候，线程一的对象，优先分配在自己单独的这块空间里，不要去抢公共空间。

这样就不用进行线程同步了，效率就变高了，也不知道我说清楚没有听明白，同学给老师扣一，这个叫t r a b，对，象不是分配在堆吗，对你在去学幼儿园的时候，对象就是分配在堆的，你现在讲大学对象。

就是可以在分配在各个位置的，t a b跟sr local有什么关系，没有半毛钱关系，就是不需要加速，你说对了，超tvb是在伊甸园里的e目前是难怪要用线程池，我感觉你的脑洞有点大。

这跟线程池有半毛钱关系吗，好我们继续当一个对象进入一点去之后，经过一次垃圾回收，如果被清掉了就结束了，如果没被清掉，进入到survivor区，survivor区域又经过一次垃圾回收，如果清调结束。

如果没被清掉，看他年龄够不够，年龄够了，进入老年代，年龄不够，进入另外一个survivor，如此循环往复再看一下这动画，当我们new出一个对象来的时候，首先尝试在站上分配，不符合战上分配条件。

嗯符合就在这儿分配不符合，看它个够不够大够大，近老年代不够大，进t r a b t r a b装不下了，进伊甸区，不管是不是最后都是在一定区里，一区你回收一次进survivor 1 slaver。

一又回收一次，看年龄够不够，年龄够了，old区年龄不够，survive 2循环往复k来能get到这个动画的，李老师可以把图装一下吧，老师什么是线上分配条件，你这个太细了啊，s一和s2 互换位置。

他为什么要互换位置，互换个名字不行吗，大哥刚开始这个是空的，它叫做to，下一次那个是空的，那个叫土不就完了吗，每个线程都有一个特t r a b吗，4d，请同学们有点问题，我暂停一小小会儿给大家回答。

大家错了，这个这个这个常见的问题啊，t r a b再讲一下，不能再讲了，l a b再讲一下，讲啥呀，提问吗，经过tvb有什么意义，tvb县城本地的不需要加锁了，好多线程。

如果没有t r a b好多线程往e点去分配，是不是大家得竞争啊，锁竞争多线程嘛，你要多线程技术没有，那那可没法跟你讲了，就那大家不抢吗，谁抢到算谁的，我是不是g y m得花精力，换资源去照顾这些线程诶。

是不是该你了，是不是该你了等等，线程同步，但是如果每个人都有自己私有的一块空间，我要拿到一个对象之后，优先往自己私有空间里装，我需要跟其他人做同步吗，需要跟其他人抢吗，不用不用，我是不是效率就提高了。

是的，可以关闭t r b e s，还可以用cs，你这不废话吗，近战条件是什么，近战条件叫做可以进行标量替换，以及不能存在本地逃逸，也就是说要进行逃逸分析和标量替换的分析啊，怎么定义大对乡村的max。

什么什么什么什么size threats hold，你搜搜一下，一搜就搜到了一电车，什么情况，直接到end，年轻代啊，年轻得回收，清完把它把它都清了，不就end了吗，t l v d和县城站有什么关系。

没有半毛钱关系，stop the world good，什么时候t l b放不下，装满了就放不下了。