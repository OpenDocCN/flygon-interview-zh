# 马士兵教育MCA架构师课程 - P4：10种垃圾回收器（二） - 马士兵学堂 - BV1RY4y1Q7DL

一点区是正方形区域吗，服啊science我我我我给你写一个大写的服嗯，我再也不背的时候撒尿了，唬你开玩笑啊，大哥他内存的区域啊，逻辑上的嗯，你可以认为是正方形的，也可以认为是长方形的，矩形的好不好，对。

和站说一下战局部变量，对new出来的对象，好了我们可以继续吧，来可以继续，同学给老师扣一哈哈哈，反正听不懂的同学们先囫囵吞枣听下来，因为你们听不懂，最关键的是因为基础不到位，连战和堆没搞清楚的同学。

这个课呢你今天可以撤了啊，两分钱就等于白扔了，嗯ok好嘞，为什么是八比一比一统计结果你自己可以设，你要愿意可以设，十比一比一，随便你，t v b先进先出还是怎么弄的，t v b是用来分配空间。

它又不是站，它跟先进先出有半毛钱关系吗，这不是不用出，ok ok好嘞好嘞，我们可以继续了吗，嗯好好看这里啊嗯嗯所以呢，由于年轻代和老年代啊，他的那个他他他他他装的东西也不一样啊。

他的这个适应的情况也不一样，算法也不一样，所以呢呃在真正的垃圾回收器组合的时候呢，它会采用不同的组合呃，分类模型从最早开始一直到现在啊，大概产生了六种，在物理上分带的这种这种垃圾回收器。

这个垃圾回收器呢呃我讲起来特别简单，它里面是可以进行各种各样组合的，什么叫做组合呢，就是这次这块撒呀，都是在年轻代回收的，这哥仨呢都是工作在老年代的，那么他们两个呢肯定要进行组合，每每个年代里头有一个。

对不对，那每个年龄有一个什么样的一个组合呢，凡是我画的这些线的地方，全都是可以进行组合的，但是啊听我说这些组合呢非常的复杂，但是但是你听但是就行了，但是往后的一般都比较重要，很简单，常用的组合就三种。

123好吧，就这这这哥俩经常配合，这哥俩经常配合，哎，这哥俩经常配合，对7月与安生是吧，那个嗯路路路路路遥和马力好吧，嗯还有谁嗯，李李李小璐和p p p g one，pg one等等啊，不管总而言之呢。

他们进行互相配合，好jdk一点八默认的这哥俩你给我记住就行了，这边俩叫啥叫parallel，scavenge以及paralleode，总而言之都是parallel，那好到现在呃，我们我们我们继续。

我来给大家解释一下啊，就这几个垃圾回收器，它的一个特点是什么，其实都非常简单，真鞋子呢都在那个j8 虚拟机规范里面都有，那这个垃圾回收器呢，最常用的最早的第一种呢叫做cereal好。

第二种呢叫做parallel，第三种呢叫c m s，这几种呢是在在在在分类模型里头啊，它是一个逐渐的演化的，好我在这先说一个结论，听我说为什么会诞生这么多的垃圾回收器，为什么会诞生这么多。

是因为随着内存的变大，不断的要满足对于垃圾回收器的要求，好这句话的最关键就在于随着内存越来越大，听我说，所有的单机回收器的衍生过程，都是随着内存越来越大，什么叫内存越来越大，哎最开始java诞生的时候。

那时候机器大概就几兆内存，到现在呢上t的内存，它的算法一定是不一样的，你在这个你的内存区里扔线团，扔线团，扔线团，你原来呢就你们家一个小床，这么大个啊，你你你你朋友，你男朋友就都都在床上扔来扔去的。

非常的面积非常小，一进来之后很容易就清掉了，可是后来呢你们开始闹大了，往天安门广场里扔太大个儿了，那我算法还能一样吗，不一样肯定不一样，所以我先说一个结论，就是随着内存越来越大。

诞生了这些不同的垃圾回收器，把这个结论先记住，内存比较小的时候用的垃圾回收器，这是内存最小的时候用垃圾回收器，这个垃圾回收器叫什么呀，这个垃圾回收器叫serial。

当然他工作在年轻代就叫serial young，他工作在老年代就叫serial，old serial的意思，读一下，看能不能读懂，看能不能读懂，嗯大家。

it's done the world coping collection，which uses a jsingle disathread，首先这里面有几个单词，第一个呢叫not the world。

世界停止copy collecture，用拷贝的拷贝算法跟他们分析过吗，八比一比一的拷贝嘛，这里面的拷贝过来拷贝过去，拷贝过来拷贝过去，which uses a single，好，这是关键。

单线程single jc thread gc是一个线程，这个线程只有一个线程，它叫做cereal，所以用图来表示的话就超级简单了，这是你的工作线程，这是你你女朋友，你男朋友在这里不停的扔小仙桃。

玩着玩着就满了，床上满了，怎么办呀，你妈妈进来，你们仨都给我听，从顶上给我站着去，下面由我来工作，他做什么工作呀，清理把该清的东西给你，清，完了好，你们仨继续，什么时候又满了，又进来了，停。

好到我工作垃圾回收机工作，你们仨继续就这么循环往复，ok为什么叫stop the world和这个词呢，在gc里面非常常见，叫s t w简称你在网上读，或者跟你的面试官去沟通的时候，别人说s t w。

你一定要理解是啥意思，为什么它叫s t w呢，是因为垃圾回收机工作的时候，你的工作线程不能干活都得给我停止，所以它叫做stop the world，我感觉是单线程，那co呢还用我说吗。

它叫做a rock the world mark sweep，或者是mark compact collector that uses single gc threat，工作在老年代里的哈哈就简单。

那么大家你拿大腿想一下啊，你们家这个地儿啊，小点的时候还行，你慢慢一个进来，一个人跨机也清理完了，马上你们就可以继续了，但是你家地儿越来越大，你们家地现在也是已经变成3百米的啊，3百米宽度的大别墅嗯。

300x300的大别墅啊，你你你你你们仨在里边扔扔扔扔扔，扔了好长时间之后，扔满了，你妈妈进来好，stop the world，然后他开始清理，你说他得清理多长时间，原来清理一秒钟就够了。

这次一小时以上，才能清理完，那这个时候你们呢大大腿想想，程序会呈现一种什么样的状态，就是你的应用程序，如果你的内存特别大，沾满了，需要stop the world停止，然后进行垃圾清理。

程序会呈现一种什么状态啊，作为用户来说，看上去你的程序就跟死了一样，半天不响应卡顿，所以随着内存越来越大，我想让你来设计，你肯定也能想出下一步怎么怎么优化，来怎么优化呀。

就是你原来一个人我能不能排多个人嘛对吧，所以就诞生了paralyscaveng proof scanders，叫做is dp，the word copy collection with that。

which uses multiple gc threats，读一下，所以他跟那个single的区别，它跟sera的区别，唯一就在于这module还多线程，嗯你爸爸你妈妈对你男朋友的爸妈。

女朋友的爸妈要进来都帮你，都帮你们清理，ok我清理来清理去，当然paralyout也不用我解释了，他说a competing elector uses mul，应该不用我解释了啊。

那现在我问大家一个问题，我的这个垃圾回收线程能不能无限制的加下去，我内存越来越大更大了，操场那么大个儿知道吗，我能不能跟我说加好多好多的垃圾回收线程，能让我的清理速度变得更快，可以吗，绝对不行。

这个问题其实就在于是不是线程越多，它的效率就越高，不是那么回事儿对吧，因为当线程数超过一定数量之后，作为管理者，作为cpu来说，他会把大量的精力花在线程切换上。

线程切换一般我们称之为叫context switch，上下文切换，当然这个概念你要不理解的话，你就想想你管两个人的时候，他们俩干活的时候，你能管的过来，你你管2万人的时候，你要想让每个人高效的工作。

我跟你说累死你了，就所以这是线程调度，他就把大量的工作，使效率的这个资源啊都花在这个调度上了，所以它的效率反而不高，因此在你的内存越来越大的时候，它依然会产生大量的卡顿现象。

这个卡顿呢是在尤其是我们线上系统，多数线上系统所不能容忍的，你不能容忍说你在那玩游戏呢，游戏服务器java写的，你一个子弹打出去，你搁那卡半天，为啥，因为垃圾回收器在回收，这玩意受得了吗。

所以好多好多的游戏服务器，游戏服务器的游戏领域，其实我跟你说，真的好多服务器都需要进行认认真真的，参数的调整和调优嗯，那有同学可能会说，老师他这个万一有了毛病，我我调不过来怎么办。

所以今天我刚才有同学不是讲实战吗，今天我先教你调优嗯，最牛逼的内容啊，这个调优呢最基础的内容哎，就是，好大家学会了吧，有同学说哈哈，这样也可以吗，你们玩游戏的时候，有没有遇到过各位各位指挥官。

那个五分钟之内呢，我们要有服务器进行进行进行维护啊，你们你们不要互相打，来，开玩笑啊，好那呃，当然这种呢不是解决问题的根本之道，解决问题的根本之道在于它c m s好，下面我重点来聊他c m s。

这也是面试的一个小小的重灾区吧，面他的挺多的，为啥呢，因为在g g one没有出现之前，我告诉你，你要想用那种响应比较快速的这样的呃，一个一个程序啊，响应比较快速啊。

没有这个s w时间特别短的这样的一个程序，你还你还只能用它，用不了别的嗯，他是一个承上启下的这么一个垃圾回收器，我一会儿再打一听，好吧好，我们稍微先把前面的简单复习一下啊，就是内存特别小的时候分带内存。

那么这时候我可以用serial和co的组合，当内存烧弹，我可以用para svp s p o的组合，这也是1。8，默认的就是它，那么当呃内存越来越大，我的响应时间要求越来越响应越来越快的时候。

就是你想响应时间要非常短非常短，就必须有响应，这时候怎么办呢，在g one没有出现之前，我们可以用谁用pu和cms好，我们先说什么叫判定panel是个什么东西呢。

pu的意思其实就还是那个parallel啊，pu的意思是parallel，new parallel，它依然是一个parle，你看他那他的那个那个那个是原封不动，在树上摘摘下来的dp。

the world coming collected usc thre，他跟那个p s p o啊没有半毛钱区别好，下面也说了区别在什么地方，他说it defer from para。

para savage in that，is enhancement that it makes you usable with the cas，什么意思呢，就是这哥们儿是专门发明出来和cms配合的。

所以呢cmc的重点，原来的那个p呀和cm s配合不好配合怎么办呢，哎专门发明出来一个新的，也是parala scale venge的一个算法差不多，但是呢有一些详细的小小的参数上。

和cm配合起来非常方便，这个叫他new，超出大部分互联网公司用的是c m s吧，no现在大部分用的都是他，我先说一个结论，所有在座的诸位啊，我不是单独指某个人啊，是说在座的所有人断水流，大师兄说的是吧。

嗯是说在座的所有人，凡是1。8的，现在优先推荐的g one，有同学说为什么推荐g one呢，听我说c m s呢叫做承上启下的，它叫做并发的垃圾回收器，前面不都是单线程的，多线程并行的，还有这种叫并发。

我一会给大家讲并发的概念是什么，但是c m s呢由于它是一个承上启下的，然后他有好多好多的bug和毛病，所以最终就会诞生一个什么现象呢，就是c m s居然不是任何一个jdk版本的，默认垃圾回收器。

就是你必须得手动手动设置它，你像1。8默认是什么p s p o一点九呢，默认g one，但是呃你有没有哪个版本是默认cm的，no没有好，我们我们来聊，我们可以继续了吗，可以继续的给老师扣一大个态度对。

但是他很重要啊，他非常非常的重要，虽然他bug有点多，但是他非常非常的重要，超级重要啊，因为他是一个承上启下的，你不理解cm s。

